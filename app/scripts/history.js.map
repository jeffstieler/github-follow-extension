{"version":3,"sources":["../scripts.babel/history.js"],"names":[],"mappings":"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","file":"history.js","sourcesContent":["'use strict';\r\n/*jshint -W069 */\r\n\r\nvar oauthToken;\r\nchrome.storage.sync.get({\r\n    oauthToken: ''\r\n}, function(items) {\r\n    oauthToken = items.oauthToken;\r\n    check();\r\n});\r\n\r\ndocument.addEventListener('DOMNodeInserted', nodeInsertedCallback);\r\n\r\nvar timeout;\r\nfunction nodeInsertedCallback(event) {\r\n\tvar id = $(event.relatedNode).attr('id');\r\n\tif (id === 'js-repo-pjax-container') {\r\n\t\tif (timeout){\r\n\t\t\tclearTimeout(timeout);\r\n\t\t}\r\n    \ttimeout = setTimeout(check, 200);\r\n\t}\r\n}\r\n\r\nfunction check() {\r\n\tvar split = $('title').text().split(' - ');\r\n\tvar ownerRepo = split[1];\r\n\tvar fileName = split[0].replace('History for ', '');\r\n\tvar sha = $('clipboard-copy').last().attr('data-clipboard-text');\r\n\tfindMove(sha, fileName, ownerRepo);\r\n}\r\n\r\nfunction findMove(sha, fileName, ownerRepo) {\r\n\tvar url = 'https://api.github.com/repos/:owner/:repo/commits/:sha'.replace(':sha', sha).replace(':owner/:repo', ownerRepo);\r\n\tget(url).done(function(data) {\r\n\t\tvar file = findFile(data.files, fileName);\r\n\t\tconsole.log(file.status, fileName);\r\n\t\tif (file.status === 'renamed') {\r\n\t\t\tvar previousFileName = file['previous_filename'];\r\n\t\t\tvar parentSha = data.parents[0].sha;\r\n\t\t\tfollow(parentSha, previousFileName, ownerRepo);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction follow(sha, fileName, ownerRepo) {\r\n\tvar url = 'https://api.github.com/repos/:owner/:repo/commits?sha=:sha&path=:path'\r\n\t\t.replace(':owner/:repo', ownerRepo)\r\n\t\t.replace(':sha', sha)\r\n\t\t.replace(':path', fileName);\r\n\r\n\tget(url).done(function(data) {\r\n\t\tvar fileSha = data[0].sha;\r\n\t\tvar link = '/:owner/:repo/commits/:sha/:fileName'\r\n\t\t\t.replace(':owner/:repo', ownerRepo)\r\n\t\t\t.replace(':sha', fileSha)\r\n\t\t\t.replace(':fileName', fileName);\r\n\r\n\t\t// var iconUrl = chrome.extension.getURL('images/icon-16.png'); \r\n\t\t// var style = '<style>.icon-follow { background-image: url(:iconUrl); background-position: center center; width:16px; height:16px; display: inline-block;</style>'\r\n\t\t// \t.replace(':iconUrl', iconUrl);\r\n\r\n\t\tvar template = ['<div id=\"github-follow\" class=\"commit-group-title\"><span class=\"octicon octicon-git-commit\"></span>'\r\n\t\t\t\t,'<strong>Renamed</strong> to :fileName <a class=\"btn right\" href=\":link\">Follow</a></div>'\r\n\t\t\t].join('')\r\n\t\t\t.replace(':fileName', fileName)\r\n\t\t\t.replace(':link', link);\r\n\r\n\t\t$('.commits-listing').append(template);\r\n\t});\r\n}\r\n\r\nfunction get(url) {\r\n\r\n\tvar headers = {\r\n\t        'Accept':'application/vnd.github.v3+json'\r\n\t};\r\n\r\n\tif (oauthToken) {\r\n\t\theaders['Authorization'] = 'token ' + oauthToken;\r\n\t}\r\n\r\n    return $.ajax({\r\n\t    type: 'GET',\r\n\t    url: url,\r\n\t    headers: headers\r\n\t});\r\n}\r\n\r\nfunction findFile(files, fileName) {\r\n    for (var i = 0, len = files.length; i < len; i++) {\r\n        if (files[i].filename === fileName) {\r\n            return files[i];\r\n        }\r\n    }\r\n    return null;\r\n}"]}